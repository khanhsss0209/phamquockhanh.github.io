<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/khanhsss0209/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=khanhsss0209/livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Xây dựng ứng dụng Chat đa người dùng với Java Socket - Hướng dẫn chi tiết | Blog Lập Trình Mạng</title>
<meta name="keywords" content="Java, Socket, Chat, Networking, Multi-threading, Programming">
<meta name="description" content="Hướng dẫn chi tiết xây dựng ứng dụng chat đa người dùng sử dụng Java Socket với multi-threading, GUI và các tính năng nâng cao">
<meta name="author" content="Phạm Quốc Khánh">
<link rel="canonical" href="http://localhost:1313/khanhsss0209/posts/java-chat-don-gian/">
<meta property="og:title" content="Xây dựng ứng dụng Chat đa người dùng với Java Socket - Hướng dẫn chi tiết | Blog Lập Trình Mạng">
<meta property="og:description" content="Hướng dẫn chi tiết xây dựng ứng dụng chat đa người dùng sử dụng Java Socket với multi-threading, GUI và các tính năng nâng cao">
<meta property="og:type" content="article">
<meta property="og:url" content="http://localhost:1313/khanhsss0209/posts/java-chat-don-gian/">
<meta property="og:image" content="http://localhost:1313/images/og-default.png">
<meta property="og:site_name" content="Blog Lập Trình Mạng">
<meta property="og:locale" content="vi_VN">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Xây dựng ứng dụng Chat đa người dùng với Java Socket - Hướng dẫn chi tiết | Blog Lập Trình Mạng">
<meta name="twitter:description" content="Hướng dẫn chi tiết xây dựng ứng dụng chat đa người dùng sử dụng Java Socket với multi-threading, GUI và các tính năng nâng cao">
<meta name="twitter:image" content="http://localhost:1313/images/og-default.png">
<style>
:root {
   
  --primary-green: #2d5a27;
  --secondary-green: #4a7c59;
  --light-green: #7fb069;
  --accent-green: #98c09a;
  --soft-green: #e8f5e8;
  --dark-green: #1a3d1a;
  
   
  --text-dark: #2c3e50;
  --text-light: #ffffff;
  --text-muted: #6c757d;
  
   
  --background-light: #f8fcf8;
  --background-white: #ffffff;
  
   
  --shadow: rgba(45, 90, 39, 0.1);
  --shadow-hover: rgba(45, 90, 39, 0.2);
  --gradient-primary: linear-gradient(135deg, var(--primary-green) 0%, var(--secondary-green) 100%);
  --gradient-soft: linear-gradient(135deg, var(--soft-green) 0%, #ffffff 100%);
  
   
  --transition-base: all 0.3s ease;
  --transition-slow: all 0.5s ease;
  
   
  --font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, 'Roboto', 'Helvetica Neue', Arial, sans-serif;
  --font-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
  
   
  --space-xs: 0.25rem;
  --space-sm: 0.5rem;
  --space-md: 1rem;
  --space-lg: 1.5rem;
  --space-xl: 2rem;
  --space-2xl: 3rem;
  
   
  --radius-sm: 0.375rem;
  --radius-md: 0.5rem;
  --radius-lg: 0.75rem;
  --radius-xl: 1rem;
  --radius-full: 9999px;
}

 
@media (prefers-color-scheme: dark) {
  :root {
    --text-dark: #ffffff;
    --text-muted: #a3a3a3;
    --background-light: #1a1a1a;
    --background-white: #2d2d2d;
    --shadow: rgba(0, 0, 0, 0.3);
    --shadow-hover: rgba(0, 0, 0, 0.5);
  }
}

.dark {
  --text-dark: #ffffff;
  --text-muted: #a3a3a3;
  --background-light: #1a1a1a;
  --background-white: #2d2d2d;
  --shadow: rgba(0, 0, 0, 0.3);
  --shadow-hover: rgba(0, 0, 0, 0.5);
}

 
* {
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
  -webkit-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
}

body {
  font-family: var(--font-family);
  line-height: 1.6;
  color: var(--text-dark);
  background: var(--background-light);
  transition: var(--transition-base);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

 
*:focus {
  outline: 2px solid var(--primary-green);
  outline-offset: 2px;
}

*:focus:not(:focus-visible) {
  outline: none;
}

 
.loading {
  opacity: 0;
  transform: translateY(20px);
  animation: fadeInUp 0.6s ease-out forwards;
}

@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

 
code {
  font-family: var(--font-mono);
  font-size: 0.9em;
  background: var(--soft-green);
  color: var(--primary-green);
  padding: 0.2em 0.4em;
  border-radius: var(--radius-sm);
  font-weight: 500;
}

pre code {
  background: none;
  color: inherit;
  padding: 0;
  font-weight: normal;
}

 
a {
  color: var(--primary-green);
  text-decoration: none;
  transition: var(--transition-base);
}

a:hover {
  color: var(--secondary-green);
}

 
table {
  width: 100%;
  border-collapse: collapse;
  margin: var(--space-lg) 0;
  background: var(--background-white);
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: 0 4px 15px var(--shadow);
}

th, td {
  padding: var(--space-md);
  text-align: left;
  border-bottom: 1px solid var(--soft-green);
}

th {
  background: var(--primary-green);
  color: var(--text-light);
  font-weight: 600;
}

tr:hover {
  background: var(--soft-green);
}

 
blockquote {
  background: var(--soft-green);
  border-left: 4px solid var(--primary-green);
  padding: var(--space-lg);
  margin: var(--space-xl) 0;
  border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
  font-style: italic;
  position: relative;
}

blockquote::before {
  content: '"';
  font-size: 4rem;
  color: var(--accent-green);
  position: absolute;
  left: var(--space-md);
  top: -10px;
  line-height: 1;
}

 
@media print {
  * {
    background: white !important;
    color: black !important;
    box-shadow: none !important;
  }
  
  a, a:visited {
    text-decoration: underline;
  }
  
  .no-print {
    display: none !important;
  }
}

 
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
  
  html {
    scroll-behavior: auto;
  }
}
</style>
<link crossorigin="anonymous" href="/khanhsss0209/assets/css/stylesheet.a482bf00fa5c046040ef7973ad5fdf5657890cacb596c93f1382f664ca542074.css" integrity="sha256-pIK/APpcBGBA73lzrV/fVleJDKy1lsk/E4L2ZMpUIHQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/khanhsss0209/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/khanhsss0209/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/khanhsss0209/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/khanhsss0209/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/khanhsss0209/safari-pinned-tab.svg">
<meta name="theme-color" content="#2d5a27">
<meta name="msapplication-TileColor" content="#2d5a27">
<link rel="alternate" hreflang="en" href="http://localhost:1313/khanhsss0209/posts/java-chat-don-gian/">

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Blog Lập Trình Mạng",
  "description": "Chia sẻ kiến thức về lập trình mạng, Java \u0026 JavaScript",
  "url": "http:\/\/localhost:1313\/khanhsss0209\/",
  "author": {
    "@type": "Person",
    "name": "Phạm Quốc Khánh",
    "email": "noobkhanh@gmail.com",
    "url": "https://github.com/khanhsss0209"
  },
  "sameAs": [
    "https://github.com/khanhsss0209"
  ],
  "potentialAction": {
    "@type": "SearchAction",
    "target": "http:\/\/localhost:1313\/khanhsss0209\//search/?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "Xây dựng ứng dụng Chat đa người dùng với Java Socket - Hướng dẫn chi tiết",
  "description": "Hướng dẫn chi tiết xây dựng ứng dụng chat đa người dùng sử dụng Java Socket với multi-threading, GUI và các tính năng nâng cao",
  "url": "http:\/\/localhost:1313\/khanhsss0209\/posts\/java-chat-don-gian\/",
  "datePublished": "2025-10-23T00:00:00Z",
  "dateModified": "2025-10-23T00:00:00Z",
  "author": {
    "@type": "Person",
    "name": "Phạm Quốc Khánh",
    "email": "noobkhanh@gmail.com"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Blog Lập Trình Mạng",
    "logo": {
      "@type": "ImageObject",
      "url": "http:\/\/localhost:1313\/images\/logo.png"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http:\/\/localhost:1313\/khanhsss0209\/posts\/java-chat-don-gian\/"
  },
  "keywords": [
    "Java",
    "Socket",
    "Chat",
    "Networking",
    "Multi-threading",
    "Programming"
  ]
}
</script>

<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }
    </style>
</noscript>
<script>
if ('serviceWorker' in navigator && location.hostname !== 'localhost') {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('/sw.js').then(function(registration) {
      console.log('SW registered: ', registration);
    }).catch(function(registrationError) {
      console.log('SW registration failed: ', registrationError);
    });
  });
}
</script>
    <style>
        :root {
            --primary-green: #2d5a27;
            --secondary-green: #4a7c59;
            --light-green: #7fb069;
            --accent-green: #98c09a;
            --soft-green: #e8f5e8;
            --dark-green: #1a3d1a;
            --text-dark: #2c3e50;
            --text-light: #ffffff;
            --background-light: #f8fcf8;
            --shadow: rgba(45, 90, 39, 0.1);
            --gradient-primary: linear-gradient(135deg, var(--primary-green) 0%, var(--secondary-green) 100%);
            --gradient-soft: linear-gradient(135deg, var(--soft-green) 0%, #ffffff 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--background-light);
            transition: all 0.3s ease;
        }

        .container {
            width: 100%;
            max-width: none;
            margin: 0;
            padding: 0;
        }

         
        .main {
            min-height: calc(100vh - 200px);
            padding: 0;
            width: 100%;
        }
        
         
        .content-wrapper {
            width: 100%;
            padding: 2rem 1rem;
            box-sizing: border-box;
        }

        @media (min-width: 768px) {
            .content-wrapper {
                padding: 2rem 2rem;
            }
        }

        @media (min-width: 1200px) {
            .content-wrapper {
                padding: 2rem 3rem;
            }
        }

        @media (min-width: 1600px) {
            .content-wrapper {
                padding: 2rem 4rem;
            }
        }
        .header {
            background: var(--gradient-primary);
            box-shadow: 0 4px 20px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav {
            padding: 1rem 0;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo a {
            color: var(--text-light);
            text-decoration: none;
            font-size: 1.8rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .logo a:hover {
            color: var(--accent-green);
            transform: scale(1.05);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--accent-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: var(--primary-green);
        }

         
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-menu li a {
            color: var(--text-light);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .nav-menu li a:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--accent-green);
            transition: left 0.3s ease;
            z-index: -1;
        }

        .nav-menu li a:hover:before,
        .nav-menu li a.active:before {
            left: 0;
        }

        .nav-menu li a:hover,
        .nav-menu li a.active {
            color: var(--primary-green);
            transform: translateY(-2px);
        }

         
        .theme-toggle {
            background: var(--accent-green);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: var(--primary-green);
        }

        .theme-toggle:hover {
            transform: rotate(180deg) scale(1.1);
            background: var(--light-green);
        }

         
        .main {
            min-height: calc(100vh - 200px);
            padding: 2rem 0;
        }

         
        .content-card {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin: 1rem 0;
            box-shadow: 0 8px 30px var(--shadow);
            border: 1px solid var(--soft-green);
            transition: all 0.3s ease;
        }

        .content-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(45, 90, 39, 0.2);
        }

         
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background: var(--gradient-primary);
            color: var(--text-light);
            text-decoration: none;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            text-align: center;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--shadow);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-green);
            border: 2px solid var(--primary-green);
        }

        .btn-outline:hover {
            background: var(--primary-green);
            color: var(--text-light);
        }

         
        .footer {
            background: var(--dark-green);
            color: var(--text-light);
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            color: var(--accent-green);
            margin-bottom: 1rem;
        }

        .footer-section a {
            color: var(--text-light);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-section a:hover {
            color: var(--accent-green);
        }

        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid var(--secondary-green);
            opacity: 0.8;
        }

         
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
                gap: 1rem;
            }

            .container {
                padding: 0 15px;
            }

            .content-card {
                padding: 1.5rem;
            }
        }

         
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeInUp 0.6s ease-out;
        }

         
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--soft-green);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--secondary-green);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-green);
        }

         
        .dark {
            --text-dark: #ffffff;
            --background-light: #1a1a1a;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        .dark .content-card {
            background: #2d2d2d;
            border-color: var(--primary-green);
        }
    </style>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="container">
            <div class="nav-container">
                <div class="logo">
                    <div class="logo-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                        </svg>
                    </div>
                    <a href="http://localhost:1313/khanhsss0209/" accesskey="h" title="Blog Lập Trình Mạng (Alt + H)">Blog Lập Trình Mạng</a>
                </div>
                <ul class="nav-menu" id="menu">
                    <li>
                        <a href="http://localhost:1313/khanhsss0209/" 
                           title="🏠 Home">🏠 Home
                        </a>
                    </li>
                    <li>
                        <a href="http://localhost:1313/khanhsss0209/posts/" 
                           title="📝 Blog">📝 Blog
                        </a>
                    </li>
                    <li>
                        <a href="http://localhost:1313/khanhsss0209/about/" 
                           title="👤 Giới thiệu">👤 Giới thiệu
                        </a>
                    </li>
                </ul>

                <div class="nav-controls">
                    <button class="theme-toggle" id="theme-toggle" accesskey="t" title="Toggle theme (Alt + T)" aria-label="Toggle theme">
                        <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                        <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                            fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" style="display: none;">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>
</header>

<style>
    .nav-controls {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .lang-switch {
        display: flex;
        list-style: none;
        gap: 0.5rem;
        align-items: center;
    }

    .lang-switch a {
        color: var(--text-light);
        text-decoration: none;
        padding: 0.25rem 0.5rem;
        border-radius: 15px;
        transition: all 0.3s ease;
    }

    .lang-switch a:hover {
        background: var(--accent-green);
        color: var(--primary-green);
    }

     
    .mobile-menu-toggle {
        display: none;
        background: none;
        border: none;
        color: var(--text-light);
        cursor: pointer;
        padding: 0.5rem;
    }

    @media (max-width: 768px) {
        .mobile-menu-toggle {
            display: block;
        }

        .nav-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--gradient-primary);
            flex-direction: column;
            padding: 1rem;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .nav-menu.active {
            display: flex;
        }

        .nav-container {
            position: relative;
        }
    }
</style>

<script>
    
    document.addEventListener('DOMContentLoaded', function() {
        const mobileToggle = document.querySelector('.mobile-menu-toggle');
        const navMenu = document.getElementById('menu');
        
        if (mobileToggle && navMenu) {
            mobileToggle.addEventListener('click', function() {
                navMenu.classList.toggle('active');
            });
        }

        
        const themeToggle = document.getElementById('theme-toggle');
        const moonIcon = document.getElementById('moon');
        const sunIcon = document.getElementById('sun');
        
        if (themeToggle && moonIcon && sunIcon) {
            function updateIcons() {
                if (document.body.classList.contains('dark')) {
                    moonIcon.style.display = 'none';
                    sunIcon.style.display = 'block';
                } else {
                    moonIcon.style.display = 'block';
                    sunIcon.style.display = 'none';
                }
            }

            themeToggle.addEventListener('click', function() {
                setTimeout(updateIcons, 50);
            });

            updateIcons(); 
        }
    });
</script><main class="main">

<div class="full-width-container">
<header class="post-header">
  <div class="content-wrapper">
    <h1 class="post-title">Xây dựng ứng dụng Chat đa người dùng với Java Socket - Hướng dẫn chi tiết</h1>
    <div class="post-description">Hướng dẫn chi tiết xây dựng ứng dụng chat đa người dùng sử dụng Java Socket với multi-threading, GUI và các tính năng nâng cao</div>
    <div class="post-meta">
      <time class="post-date">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        23/10/2025
      </time>
      <div class="post-tags">
        <a href="/tags/java" class="tag">Java</a>
        <a href="/tags/socket" class="tag">Socket</a>
        <a href="/tags/chat" class="tag">Chat</a>
        <a href="/tags/networking" class="tag">Networking</a>
        <a href="/tags/multi-threading" class="tag">Multi-threading</a>
        <a href="/tags/programming" class="tag">Programming</a>
      </div>
      <div class="reading-stats">
        <span class="reading-time">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12,6 12,12 16,14"></polyline>
          </svg>
          16 phút đọc
        </span>
        <span class="word-count">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14,2 14,8 20,8"></polyline>
          </svg>
          3112 từ
        </span>
      </div>
    </div>
  </div>
</header>

<article class="post-content-section">
  <div class="content-wrapper">
    <div class="post-content"><h2 id="giới-thiệu">Giới thiệu<a hidden class="anchor" aria-hidden="true" href="#giới-thiệu">#</a></h2>
<p>Lập trình mạng với Java Socket là một kỹ năng quan trọng giúp chúng ta hiểu cách các ứng dụng giao tiếp qua mạng. Trong bài viết này, chúng ta sẽ xây dựng một ứng dụng chat đa người dùng hoàn chỉnh từ cơ bản đến nâng cao.</p>
<h2 id="kiến-thức-cần-có">Kiến thức cần có<a hidden class="anchor" aria-hidden="true" href="#kiến-thức-cần-có">#</a></h2>
<p>Trước khi bắt đầu, bạn nên có kiến thức về:</p>
<ul>
<li><strong>Java cơ bản</strong>: OOP, Exception handling</li>
<li><strong>Multi-threading</strong>: Thread, Runnable interface</li>
<li><strong>Java Swing</strong>: GUI components</li>
<li><strong>TCP/IP</strong>: Hiểu cơ bản về giao thức mạng</li>
</ul>
<h2 id="kiến-trúc-tổng-quan">Kiến trúc tổng quan<a hidden class="anchor" aria-hidden="true" href="#kiến-trúc-tổng-quan">#</a></h2>
<h3 id="mô-hình-client-server">Mô hình Client-Server<a hidden class="anchor" aria-hidden="true" href="#mô-hình-client-server">#</a></h3>
<pre tabindex="0"><code>[Client 1] ----\
                \
[Client 2] ----&gt; [Server] ----&gt; [Clients Management]
                /                      |
[Client 3] ----/                [Message Broadcasting]
</code></pre><h3 id="các-thành-phần-chính">Các thành phần chính<a hidden class="anchor" aria-hidden="true" href="#các-thành-phần-chính">#</a></h3>
<ol>
<li><strong>Server</strong>: Quản lý kết nối và broadcast tin nhắn</li>
<li><strong>Client</strong>: Giao diện người dùng và gửi/nhận tin nhắn</li>
<li><strong>Protocol</strong>: Định nghĩa format tin nhắn</li>
<li><strong>Threading</strong>: Xử lý đồng thời nhiều client</li>
</ol>
<h2 id="phát-triển-server">Phát triển Server<a hidden class="anchor" aria-hidden="true" href="#phát-triển-server">#</a></h2>
<h3 id="1-chatserver---lớp-chính">1. ChatServer - Lớp chính<a hidden class="anchor" aria-hidden="true" href="#1-chatserver---lớp-chính">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.chatapp.server;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.net.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.concurrent.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.logging.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChatServer</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Logger LOGGER <span style="color:#f92672">=</span> Logger.<span style="color:#a6e22e">getLogger</span>(ChatServer.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> PORT <span style="color:#f92672">=</span> 12345;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> MAX_CLIENTS <span style="color:#f92672">=</span> 50;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> ServerSocket serverSocket;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">volatile</span> <span style="color:#66d9ef">boolean</span> running <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> ExecutorService clientPool;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Map<span style="color:#f92672">&lt;</span>String, ClientHandler<span style="color:#f92672">&gt;</span> connectedClients;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> chatHistory;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ChatServer</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">clientPool</span> <span style="color:#f92672">=</span> Executors.<span style="color:#a6e22e">newFixedThreadPool</span>(MAX_CLIENTS);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">connectedClients</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConcurrentHashMap<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">chatHistory</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        setupLogging();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setupLogging</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            FileHandler fileHandler <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> FileHandler(<span style="color:#e6db74">&#34;server.log&#34;</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>            fileHandler.<span style="color:#a6e22e">setFormatter</span>(<span style="color:#66d9ef">new</span> SimpleFormatter());
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">addHandler</span>(fileHandler);
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">setLevel</span>(Level.<span style="color:#a6e22e">INFO</span>);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Could not setup logging: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">start</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            serverSocket <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ServerSocket(PORT);
</span></span><span style="display:flex;"><span>            running <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Chat Server started on port &#34;</span> <span style="color:#f92672">+</span> PORT);
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;🚀 Chat Server is running on port &#34;</span> <span style="color:#f92672">+</span> PORT);
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Waiting for clients to connect...&#34;</span>);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Accept client connections</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">while</span> (running) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                    Socket clientSocket <span style="color:#f92672">=</span> serverSocket.<span style="color:#a6e22e">accept</span>();
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (connectedClients.<span style="color:#a6e22e">size</span>() <span style="color:#f92672">&gt;=</span> MAX_CLIENTS) {
</span></span><span style="display:flex;"><span>                        rejectClient(clientSocket, <span style="color:#e6db74">&#34;Server is full&#34;</span>);
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">continue</span>;
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    ClientHandler clientHandler <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ClientHandler(clientSocket, <span style="color:#66d9ef">this</span>);
</span></span><span style="display:flex;"><span>                    clientPool.<span style="color:#a6e22e">submit</span>(clientHandler);
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (running) {
</span></span><span style="display:flex;"><span>                        LOGGER.<span style="color:#a6e22e">warning</span>(<span style="color:#e6db74">&#34;Error accepting client connection: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">severe</span>(<span style="color:#e6db74">&#34;Could not start server: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;❌ Could not start server: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">rejectClient</span>(Socket clientSocket, String reason) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> (PrintWriter out <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> PrintWriter(
</span></span><span style="display:flex;"><span>                clientSocket.<span style="color:#a6e22e">getOutputStream</span>(), <span style="color:#66d9ef">true</span>)) {
</span></span><span style="display:flex;"><span>            out.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;REJECTED:&#34;</span> <span style="color:#f92672">+</span> reason);
</span></span><span style="display:flex;"><span>            clientSocket.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Client rejected: &#34;</span> <span style="color:#f92672">+</span> reason);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">warning</span>(<span style="color:#e6db74">&#34;Error rejecting client: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">addClient</span>(String username, ClientHandler handler) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (connectedClients.<span style="color:#a6e22e">containsKey</span>(username)) {
</span></span><span style="display:flex;"><span>            handler.<span style="color:#a6e22e">sendMessage</span>(<span style="color:#e6db74">&#34;ERROR:Username already taken&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        connectedClients.<span style="color:#a6e22e">put</span>(username, handler);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Send welcome message</span>
</span></span><span style="display:flex;"><span>        handler.<span style="color:#a6e22e">sendMessage</span>(<span style="color:#e6db74">&#34;WELCOME:Welcome to the chat, &#34;</span> <span style="color:#f92672">+</span> username <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;!&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Send chat history</span>
</span></span><span style="display:flex;"><span>        sendChatHistory(handler);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Send current users list</span>
</span></span><span style="display:flex;"><span>        sendUsersList(handler);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Notify all clients about new user</span>
</span></span><span style="display:flex;"><span>        broadcastMessage(<span style="color:#e6db74">&#34;USER_JOINED:&#34;</span> <span style="color:#f92672">+</span> username <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; joined the chat&#34;</span>, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>        broadcastUsersList();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        LOGGER.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;User &#34;</span> <span style="color:#f92672">+</span> username <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; connected. Total users: &#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>                   connectedClients.<span style="color:#a6e22e">size</span>());
</span></span><span style="display:flex;"><span>        System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;✅ &#34;</span> <span style="color:#f92672">+</span> username <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; joined. Active users: &#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>                          connectedClients.<span style="color:#a6e22e">size</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">removeClient</span>(String username) {
</span></span><span style="display:flex;"><span>        ClientHandler removed <span style="color:#f92672">=</span> connectedClients.<span style="color:#a6e22e">remove</span>(username);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (removed <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            broadcastMessage(<span style="color:#e6db74">&#34;USER_LEFT:&#34;</span> <span style="color:#f92672">+</span> username <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; left the chat&#34;</span>, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>            broadcastUsersList();
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;User &#34;</span> <span style="color:#f92672">+</span> username <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; disconnected. Total users: &#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>                       connectedClients.<span style="color:#a6e22e">size</span>());
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;❌ &#34;</span> <span style="color:#f92672">+</span> username <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; left. Active users: &#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>                              connectedClients.<span style="color:#a6e22e">size</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">broadcastMessage</span>(String message, String sender) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Add to history (except system messages)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (sender <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            String timestamp <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Date().<span style="color:#a6e22e">toString</span>();
</span></span><span style="display:flex;"><span>            String historyEntry <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;[&#34;</span> <span style="color:#f92672">+</span> timestamp <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] &#34;</span> <span style="color:#f92672">+</span> sender <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">+</span> message;
</span></span><span style="display:flex;"><span>            chatHistory.<span style="color:#a6e22e">add</span>(historyEntry);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Keep only last 100 messages</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (chatHistory.<span style="color:#a6e22e">size</span>() <span style="color:#f92672">&gt;</span> 100) {
</span></span><span style="display:flex;"><span>                chatHistory.<span style="color:#a6e22e">remove</span>(0);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Broadcast to all clients</span>
</span></span><span style="display:flex;"><span>        String fullMessage <span style="color:#f92672">=</span> sender <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">?</span> 
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;MESSAGE:&#34;</span> <span style="color:#f92672">+</span> sender <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> message : message;
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> disconnectedUsers <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (Map.<span style="color:#a6e22e">Entry</span><span style="color:#f92672">&lt;</span>String, ClientHandler<span style="color:#f92672">&gt;</span> entry : connectedClients.<span style="color:#a6e22e">entrySet</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>entry.<span style="color:#a6e22e">getValue</span>().<span style="color:#a6e22e">sendMessage</span>(fullMessage)) {
</span></span><span style="display:flex;"><span>                disconnectedUsers.<span style="color:#a6e22e">add</span>(entry.<span style="color:#a6e22e">getKey</span>());
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Remove disconnected users</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (String user : disconnectedUsers) {
</span></span><span style="display:flex;"><span>            removeClient(user);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (sender <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Broadcast message from &#34;</span> <span style="color:#f92672">+</span> sender <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">+</span> message);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sendPrivateMessage</span>(String from, String to, String message) {
</span></span><span style="display:flex;"><span>        ClientHandler recipient <span style="color:#f92672">=</span> connectedClients.<span style="color:#a6e22e">get</span>(to);
</span></span><span style="display:flex;"><span>        ClientHandler sender <span style="color:#f92672">=</span> connectedClients.<span style="color:#a6e22e">get</span>(from);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (recipient <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            recipient.<span style="color:#a6e22e">sendMessage</span>(<span style="color:#e6db74">&#34;PRIVATE:&#34;</span> <span style="color:#f92672">+</span> from <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> message);
</span></span><span style="display:flex;"><span>            sender.<span style="color:#a6e22e">sendMessage</span>(<span style="color:#e6db74">&#34;PRIVATE_SENT:&#34;</span> <span style="color:#f92672">+</span> to <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> message);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Private message from &#34;</span> <span style="color:#f92672">+</span> from <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; to &#34;</span> <span style="color:#f92672">+</span> to <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">+</span> message);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            sender.<span style="color:#a6e22e">sendMessage</span>(<span style="color:#e6db74">&#34;ERROR:User &#34;</span> <span style="color:#f92672">+</span> to <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; not found&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sendChatHistory</span>(ClientHandler handler) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (String message : chatHistory) {
</span></span><span style="display:flex;"><span>            handler.<span style="color:#a6e22e">sendMessage</span>(<span style="color:#e6db74">&#34;HISTORY:&#34;</span> <span style="color:#f92672">+</span> message);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sendUsersList</span>(ClientHandler handler) {
</span></span><span style="display:flex;"><span>        StringBuilder users <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuilder(<span style="color:#e6db74">&#34;USERS:&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (String username : connectedClients.<span style="color:#a6e22e">keySet</span>()) {
</span></span><span style="display:flex;"><span>            users.<span style="color:#a6e22e">append</span>(username).<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#34;,&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        handler.<span style="color:#a6e22e">sendMessage</span>(users.<span style="color:#a6e22e">toString</span>());
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">broadcastUsersList</span>() {
</span></span><span style="display:flex;"><span>        StringBuilder users <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuilder(<span style="color:#e6db74">&#34;USERS:&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (String username : connectedClients.<span style="color:#a6e22e">keySet</span>()) {
</span></span><span style="display:flex;"><span>            users.<span style="color:#a6e22e">append</span>(username).<span style="color:#a6e22e">append</span>(<span style="color:#e6db74">&#34;,&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        String usersList <span style="color:#f92672">=</span> users.<span style="color:#a6e22e">toString</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (ClientHandler handler : connectedClients.<span style="color:#a6e22e">values</span>()) {
</span></span><span style="display:flex;"><span>            handler.<span style="color:#a6e22e">sendMessage</span>(usersList);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">stop</span>() {
</span></span><span style="display:flex;"><span>        running <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Notify all clients</span>
</span></span><span style="display:flex;"><span>            broadcastMessage(<span style="color:#e6db74">&#34;SERVER_SHUTDOWN:Server is shutting down&#34;</span>, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Close all client connections</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (ClientHandler handler : connectedClients.<span style="color:#a6e22e">values</span>()) {
</span></span><span style="display:flex;"><span>                handler.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Shutdown thread pool</span>
</span></span><span style="display:flex;"><span>            clientPool.<span style="color:#a6e22e">shutdown</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>clientPool.<span style="color:#a6e22e">awaitTermination</span>(5, TimeUnit.<span style="color:#a6e22e">SECONDS</span>)) {
</span></span><span style="display:flex;"><span>                clientPool.<span style="color:#a6e22e">shutdownNow</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Close server socket</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (serverSocket <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>serverSocket.<span style="color:#a6e22e">isClosed</span>()) {
</span></span><span style="display:flex;"><span>                serverSocket.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">info</span>(<span style="color:#e6db74">&#34;Chat Server stopped&#34;</span>);
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">out</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;🔴 Chat Server stopped&#34;</span>);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException <span style="color:#f92672">|</span> InterruptedException e) {
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">severe</span>(<span style="color:#e6db74">&#34;Error stopping server: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        ChatServer server <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ChatServer();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Graceful shutdown</span>
</span></span><span style="display:flex;"><span>        Runtime.<span style="color:#a6e22e">getRuntime</span>().<span style="color:#a6e22e">addShutdownHook</span>(<span style="color:#66d9ef">new</span> Thread(server::stop));
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        server.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="2-clienthandler---xử-lý-từng-client">2. ClientHandler - Xử lý từng client<a hidden class="anchor" aria-hidden="true" href="#2-clienthandler---xử-lý-từng-client">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.chatapp.server;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.net.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.logging.Logger;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ClientHandler</span> <span style="color:#66d9ef">implements</span> Runnable {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> Logger LOGGER <span style="color:#f92672">=</span> Logger.<span style="color:#a6e22e">getLogger</span>(ClientHandler.<span style="color:#a6e22e">class</span>.<span style="color:#a6e22e">getName</span>());
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Socket clientSocket;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> ChatServer server;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> BufferedReader in;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> PrintWriter out;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String username;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">volatile</span> <span style="color:#66d9ef">boolean</span> running <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ClientHandler</span>(Socket socket, ChatServer server) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">clientSocket</span> <span style="color:#f92672">=</span> socket;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">server</span> <span style="color:#f92672">=</span> server;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            setupStreams();
</span></span><span style="display:flex;"><span>            handleClientCommunication();
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">warning</span>(<span style="color:#e6db74">&#34;Client communication error: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">finally</span> {
</span></span><span style="display:flex;"><span>            cleanup();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setupStreams</span>() <span style="color:#66d9ef">throws</span> IOException {
</span></span><span style="display:flex;"><span>        in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader(<span style="color:#66d9ef">new</span> InputStreamReader(
</span></span><span style="display:flex;"><span>            clientSocket.<span style="color:#a6e22e">getInputStream</span>()));
</span></span><span style="display:flex;"><span>        out <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> PrintWriter(clientSocket.<span style="color:#a6e22e">getOutputStream</span>(), <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">handleClientCommunication</span>() <span style="color:#66d9ef">throws</span> IOException {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Wait for username</span>
</span></span><span style="display:flex;"><span>        String firstMessage <span style="color:#f92672">=</span> in.<span style="color:#a6e22e">readLine</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (firstMessage <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>firstMessage.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;USERNAME:&#34;</span>)) {
</span></span><span style="display:flex;"><span>            sendMessage(<span style="color:#e6db74">&#34;ERROR:Please provide username&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        username <span style="color:#f92672">=</span> firstMessage.<span style="color:#a6e22e">substring</span>(9).<span style="color:#a6e22e">trim</span>();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (username.<span style="color:#a6e22e">isEmpty</span>() <span style="color:#f92672">||</span> username.<span style="color:#a6e22e">contains</span>(<span style="color:#e6db74">&#34;:&#34;</span>) <span style="color:#f92672">||</span> username.<span style="color:#a6e22e">contains</span>(<span style="color:#e6db74">&#34;,&#34;</span>)) {
</span></span><span style="display:flex;"><span>            sendMessage(<span style="color:#e6db74">&#34;ERROR:Invalid username format&#34;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Add to server</span>
</span></span><span style="display:flex;"><span>        server.<span style="color:#a6e22e">addClient</span>(username, <span style="color:#66d9ef">this</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Listen for messages</span>
</span></span><span style="display:flex;"><span>        String inputLine;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> (running <span style="color:#f92672">&amp;&amp;</span> (inputLine <span style="color:#f92672">=</span> in.<span style="color:#a6e22e">readLine</span>()) <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            processMessage(inputLine);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">processMessage</span>(String message) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;MESSAGE:&#34;</span>)) {
</span></span><span style="display:flex;"><span>                String content <span style="color:#f92672">=</span> message.<span style="color:#a6e22e">substring</span>(8);
</span></span><span style="display:flex;"><span>                server.<span style="color:#a6e22e">broadcastMessage</span>(content, username);
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;PRIVATE:&#34;</span>)) {
</span></span><span style="display:flex;"><span>                String<span style="color:#f92672">[]</span> parts <span style="color:#f92672">=</span> message.<span style="color:#a6e22e">substring</span>(8).<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;:&#34;</span>, 2);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (parts.<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> 2) {
</span></span><span style="display:flex;"><span>                    String recipient <span style="color:#f92672">=</span> parts<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>                    String content <span style="color:#f92672">=</span> parts<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>                    server.<span style="color:#a6e22e">sendPrivateMessage</span>(username, recipient, content);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">equals</span>(<span style="color:#e6db74">&#34;DISCONNECT&#34;</span>)) {
</span></span><span style="display:flex;"><span>                running <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                sendMessage(<span style="color:#e6db74">&#34;ERROR:Unknown command format&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">warning</span>(<span style="color:#e6db74">&#34;Error processing message from &#34;</span> <span style="color:#f92672">+</span> username <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>                          e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">sendMessage</span>(String message) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            out.<span style="color:#a6e22e">println</span>(message);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#f92672">!</span>out.<span style="color:#a6e22e">checkError</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">warning</span>(<span style="color:#e6db74">&#34;Error sending message to &#34;</span> <span style="color:#f92672">+</span> username <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>                          e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">close</span>() {
</span></span><span style="display:flex;"><span>        running <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        cleanup();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">cleanup</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (username <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                server.<span style="color:#a6e22e">removeClient</span>(username);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (in <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) in.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (out <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) out.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (clientSocket <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>clientSocket.<span style="color:#a6e22e">isClosed</span>()) {
</span></span><span style="display:flex;"><span>                clientSocket.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            LOGGER.<span style="color:#a6e22e">warning</span>(<span style="color:#e6db74">&#34;Error during cleanup: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getUsername</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> username;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="phát-triển-client">Phát triển Client<a hidden class="anchor" aria-hidden="true" href="#phát-triển-client">#</a></h2>
<h3 id="1-chatclient---lớp-kết-nối">1. ChatClient - Lớp kết nối<a hidden class="anchor" aria-hidden="true" href="#1-chatclient---lớp-kết-nối">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.chatapp.client;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.swing.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.io.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.net.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.concurrent.BlockingQueue;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.concurrent.LinkedBlockingQueue;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChatClient</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> String SERVER_HOST <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;localhost&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> SERVER_PORT <span style="color:#f92672">=</span> 12345;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Socket socket;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> BufferedReader in;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> PrintWriter out;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> String username;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> ChatGUI gui;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">volatile</span> <span style="color:#66d9ef">boolean</span> connected <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Thread messageListener;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> BlockingQueue<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> messageQueue;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ChatClient</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">messageQueue</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> LinkedBlockingQueue<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">connect</span>(String username) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">username</span> <span style="color:#f92672">=</span> username;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            socket <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket(SERVER_HOST, SERVER_PORT);
</span></span><span style="display:flex;"><span>            in <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> BufferedReader(<span style="color:#66d9ef">new</span> InputStreamReader(socket.<span style="color:#a6e22e">getInputStream</span>()));
</span></span><span style="display:flex;"><span>            out <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> PrintWriter(socket.<span style="color:#a6e22e">getOutputStream</span>(), <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Send username</span>
</span></span><span style="display:flex;"><span>            out.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;USERNAME:&#34;</span> <span style="color:#f92672">+</span> username);
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">// Wait for server response</span>
</span></span><span style="display:flex;"><span>            String response <span style="color:#f92672">=</span> in.<span style="color:#a6e22e">readLine</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (response <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> response.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;ERROR:&#34;</span>)) {
</span></span><span style="display:flex;"><span>                JOptionPane.<span style="color:#a6e22e">showMessageDialog</span>(<span style="color:#66d9ef">null</span>, 
</span></span><span style="display:flex;"><span>                    response.<span style="color:#a6e22e">substring</span>(6), <span style="color:#e6db74">&#34;Connection Error&#34;</span>, 
</span></span><span style="display:flex;"><span>                    JOptionPane.<span style="color:#a6e22e">ERROR_MESSAGE</span>);
</span></span><span style="display:flex;"><span>                disconnect();
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            connected <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>            startMessageListener();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            JOptionPane.<span style="color:#a6e22e">showMessageDialog</span>(<span style="color:#66d9ef">null</span>, 
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Could not connect to server: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>(), 
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;Connection Error&#34;</span>, JOptionPane.<span style="color:#a6e22e">ERROR_MESSAGE</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">startMessageListener</span>() {
</span></span><span style="display:flex;"><span>        messageListener <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                String message;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">while</span> (connected <span style="color:#f92672">&amp;&amp;</span> (message <span style="color:#f92672">=</span> in.<span style="color:#a6e22e">readLine</span>()) <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                    messageQueue.<span style="color:#a6e22e">offer</span>(message);
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    SwingUtilities.<span style="color:#a6e22e">invokeLater</span>(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>                        processServerMessage(messageQueue.<span style="color:#a6e22e">poll</span>());
</span></span><span style="display:flex;"><span>                    });
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (connected) {
</span></span><span style="display:flex;"><span>                    SwingUtilities.<span style="color:#a6e22e">invokeLater</span>(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>                        gui.<span style="color:#a6e22e">showSystemMessage</span>(<span style="color:#e6db74">&#34;❌ Connection lost: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>                        disconnect();
</span></span><span style="display:flex;"><span>                    });
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        messageListener.<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">processServerMessage</span>(String message) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (message <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;WELCOME:&#34;</span>)) {
</span></span><span style="display:flex;"><span>                gui.<span style="color:#a6e22e">showSystemMessage</span>(<span style="color:#e6db74">&#34;🎉 &#34;</span> <span style="color:#f92672">+</span> message.<span style="color:#a6e22e">substring</span>(8));
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;MESSAGE:&#34;</span>)) {
</span></span><span style="display:flex;"><span>                String<span style="color:#f92672">[]</span> parts <span style="color:#f92672">=</span> message.<span style="color:#a6e22e">substring</span>(8).<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;:&#34;</span>, 2);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (parts.<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> 2) {
</span></span><span style="display:flex;"><span>                    gui.<span style="color:#a6e22e">displayMessage</span>(parts<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>, parts<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;PRIVATE:&#34;</span>)) {
</span></span><span style="display:flex;"><span>                String<span style="color:#f92672">[]</span> parts <span style="color:#f92672">=</span> message.<span style="color:#a6e22e">substring</span>(8).<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;:&#34;</span>, 2);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (parts.<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> 2) {
</span></span><span style="display:flex;"><span>                    gui.<span style="color:#a6e22e">displayPrivateMessage</span>(parts<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>, parts<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>, <span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;PRIVATE_SENT:&#34;</span>)) {
</span></span><span style="display:flex;"><span>                String<span style="color:#f92672">[]</span> parts <span style="color:#f92672">=</span> message.<span style="color:#a6e22e">substring</span>(13).<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;:&#34;</span>, 2);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (parts.<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> 2) {
</span></span><span style="display:flex;"><span>                    gui.<span style="color:#a6e22e">displayPrivateMessage</span>(parts<span style="color:#f92672">[</span>0<span style="color:#f92672">]</span>, parts<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;USER_JOINED:&#34;</span>)) {
</span></span><span style="display:flex;"><span>                gui.<span style="color:#a6e22e">showSystemMessage</span>(<span style="color:#e6db74">&#34;✅ &#34;</span> <span style="color:#f92672">+</span> message.<span style="color:#a6e22e">substring</span>(12));
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;USER_LEFT:&#34;</span>)) {
</span></span><span style="display:flex;"><span>                gui.<span style="color:#a6e22e">showSystemMessage</span>(<span style="color:#e6db74">&#34;❌ &#34;</span> <span style="color:#f92672">+</span> message.<span style="color:#a6e22e">substring</span>(10));
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;USERS:&#34;</span>)) {
</span></span><span style="display:flex;"><span>                String usersList <span style="color:#f92672">=</span> message.<span style="color:#a6e22e">substring</span>(6);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>usersList.<span style="color:#a6e22e">isEmpty</span>()) {
</span></span><span style="display:flex;"><span>                    String<span style="color:#f92672">[]</span> users <span style="color:#f92672">=</span> usersList.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;,&#34;</span>);
</span></span><span style="display:flex;"><span>                    gui.<span style="color:#a6e22e">updateUsersList</span>(users);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;HISTORY:&#34;</span>)) {
</span></span><span style="display:flex;"><span>                gui.<span style="color:#a6e22e">displayHistoryMessage</span>(message.<span style="color:#a6e22e">substring</span>(8));
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;ERROR:&#34;</span>)) {
</span></span><span style="display:flex;"><span>                gui.<span style="color:#a6e22e">showSystemMessage</span>(<span style="color:#e6db74">&#34;⚠️ &#34;</span> <span style="color:#f92672">+</span> message.<span style="color:#a6e22e">substring</span>(6));
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;SERVER_SHUTDOWN:&#34;</span>)) {
</span></span><span style="display:flex;"><span>                gui.<span style="color:#a6e22e">showSystemMessage</span>(<span style="color:#e6db74">&#34;🔴 &#34;</span> <span style="color:#f92672">+</span> message.<span style="color:#a6e22e">substring</span>(16));
</span></span><span style="display:flex;"><span>                disconnect();
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (message.<span style="color:#a6e22e">startsWith</span>(<span style="color:#e6db74">&#34;REJECTED:&#34;</span>)) {
</span></span><span style="display:flex;"><span>                JOptionPane.<span style="color:#a6e22e">showMessageDialog</span>(gui, 
</span></span><span style="display:flex;"><span>                    message.<span style="color:#a6e22e">substring</span>(9), <span style="color:#e6db74">&#34;Connection Rejected&#34;</span>, 
</span></span><span style="display:flex;"><span>                    JOptionPane.<span style="color:#a6e22e">ERROR_MESSAGE</span>);
</span></span><span style="display:flex;"><span>                disconnect();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            gui.<span style="color:#a6e22e">showSystemMessage</span>(<span style="color:#e6db74">&#34;⚠️ Error processing message: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sendMessage</span>(String message) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (connected <span style="color:#f92672">&amp;&amp;</span> out <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            out.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;MESSAGE:&#34;</span> <span style="color:#f92672">+</span> message);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sendPrivateMessage</span>(String recipient, String message) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (connected <span style="color:#f92672">&amp;&amp;</span> out <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>            out.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;PRIVATE:&#34;</span> <span style="color:#f92672">+</span> recipient <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> message);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">disconnect</span>() {
</span></span><span style="display:flex;"><span>        connected <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (out <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                out.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;DISCONNECT&#34;</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (messageListener <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> messageListener.<span style="color:#a6e22e">isAlive</span>()) {
</span></span><span style="display:flex;"><span>                messageListener.<span style="color:#a6e22e">interrupt</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (in <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) in.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (out <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) out.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (socket <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>socket.<span style="color:#a6e22e">isClosed</span>()) {
</span></span><span style="display:flex;"><span>                socket.<span style="color:#a6e22e">close</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (gui <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                gui.<span style="color:#a6e22e">onDisconnected</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            System.<span style="color:#a6e22e">err</span>.<span style="color:#a6e22e">println</span>(<span style="color:#e6db74">&#34;Error during disconnect: &#34;</span> <span style="color:#f92672">+</span> e.<span style="color:#a6e22e">getMessage</span>());
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">boolean</span> <span style="color:#a6e22e">isConnected</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> connected;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getUsername</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> username;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setGUI</span>(ChatGUI gui) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">gui</span> <span style="color:#f92672">=</span> gui;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="2-chatgui---giao-diện-người-dùng">2. ChatGUI - Giao diện người dùng<a hidden class="anchor" aria-hidden="true" href="#2-chatgui---giao-diện-người-dùng">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">package</span> com.chatapp.client;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.swing.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.swing.border.EmptyBorder;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> javax.swing.text.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.awt.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.awt.event.*;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.text.SimpleDateFormat;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> java.util.Date;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChatGUI</span> <span style="color:#66d9ef">extends</span> JFrame {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> ChatClient client;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> JTextPane chatArea;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> JTextField messageField;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> JButton sendButton;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> JList<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> usersList;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> DefaultListModel<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> usersModel;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> JButton connectButton;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> JButton disconnectButton;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> JTextField usernameField;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> SimpleDateFormat timeFormat;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> StyledDocument chatDocument;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Styles for different message types</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Style defaultStyle;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Style systemStyle;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Style userStyle;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Style privateStyle;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> Style timestampStyle;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ChatGUI</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">client</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ChatClient();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">timeFormat</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SimpleDateFormat(<span style="color:#e6db74">&#34;HH:mm:ss&#34;</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        client.<span style="color:#a6e22e">setGUI</span>(<span style="color:#66d9ef">this</span>);
</span></span><span style="display:flex;"><span>        initializeComponents();
</span></span><span style="display:flex;"><span>        setupStyles();
</span></span><span style="display:flex;"><span>        setupLayout();
</span></span><span style="display:flex;"><span>        setupEventHandlers();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        setTitle(<span style="color:#e6db74">&#34;Java Chat Client&#34;</span>);
</span></span><span style="display:flex;"><span>        setDefaultCloseOperation(JFrame.<span style="color:#a6e22e">EXIT_ON_CLOSE</span>);
</span></span><span style="display:flex;"><span>        setSize(800, 600);
</span></span><span style="display:flex;"><span>        setLocationRelativeTo(<span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Window close handler</span>
</span></span><span style="display:flex;"><span>        addWindowListener(<span style="color:#66d9ef">new</span> WindowAdapter() {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">windowClosing</span>(WindowEvent e) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (client.<span style="color:#a6e22e">isConnected</span>()) {
</span></span><span style="display:flex;"><span>                    client.<span style="color:#a6e22e">disconnect</span>();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                System.<span style="color:#a6e22e">exit</span>(0);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">initializeComponents</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Chat area</span>
</span></span><span style="display:flex;"><span>        chatArea <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JTextPane();
</span></span><span style="display:flex;"><span>        chatArea.<span style="color:#a6e22e">setEditable</span>(<span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>        chatArea.<span style="color:#a6e22e">setBackground</span>(<span style="color:#66d9ef">new</span> Color(248, 249, 250));
</span></span><span style="display:flex;"><span>        chatDocument <span style="color:#f92672">=</span> chatArea.<span style="color:#a6e22e">getStyledDocument</span>();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Message input</span>
</span></span><span style="display:flex;"><span>        messageField <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JTextField();
</span></span><span style="display:flex;"><span>        sendButton <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JButton(<span style="color:#e6db74">&#34;Send&#34;</span>);
</span></span><span style="display:flex;"><span>        sendButton.<span style="color:#a6e22e">setPreferredSize</span>(<span style="color:#66d9ef">new</span> Dimension(80, 30));
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Users list</span>
</span></span><span style="display:flex;"><span>        usersModel <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DefaultListModel<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>        usersList <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JList<span style="color:#f92672">&lt;&gt;</span>(usersModel);
</span></span><span style="display:flex;"><span>        usersList.<span style="color:#a6e22e">setSelectionMode</span>(ListSelectionModel.<span style="color:#a6e22e">SINGLE_SELECTION</span>);
</span></span><span style="display:flex;"><span>        usersList.<span style="color:#a6e22e">setBorder</span>(BorderFactory.<span style="color:#a6e22e">createTitledBorder</span>(<span style="color:#e6db74">&#34;Online Users&#34;</span>));
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Connection controls</span>
</span></span><span style="display:flex;"><span>        usernameField <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JTextField(<span style="color:#e6db74">&#34;User&#34;</span> <span style="color:#f92672">+</span> (<span style="color:#66d9ef">int</span>)(Math.<span style="color:#a6e22e">random</span>() <span style="color:#f92672">*</span> 1000));
</span></span><span style="display:flex;"><span>        connectButton <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JButton(<span style="color:#e6db74">&#34;Connect&#34;</span>);
</span></span><span style="display:flex;"><span>        disconnectButton <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JButton(<span style="color:#e6db74">&#34;Disconnect&#34;</span>);
</span></span><span style="display:flex;"><span>        disconnectButton.<span style="color:#a6e22e">setEnabled</span>(<span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setupStyles</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Default style</span>
</span></span><span style="display:flex;"><span>        defaultStyle <span style="color:#f92672">=</span> chatDocument.<span style="color:#a6e22e">addStyle</span>(<span style="color:#e6db74">&#34;default&#34;</span>, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>        StyleConstants.<span style="color:#a6e22e">setFontFamily</span>(defaultStyle, <span style="color:#e6db74">&#34;SansSerif&#34;</span>);
</span></span><span style="display:flex;"><span>        StyleConstants.<span style="color:#a6e22e">setFontSize</span>(defaultStyle, 12);
</span></span><span style="display:flex;"><span>        StyleConstants.<span style="color:#a6e22e">setForeground</span>(defaultStyle, Color.<span style="color:#a6e22e">BLACK</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// System messages style</span>
</span></span><span style="display:flex;"><span>        systemStyle <span style="color:#f92672">=</span> chatDocument.<span style="color:#a6e22e">addStyle</span>(<span style="color:#e6db74">&#34;system&#34;</span>, defaultStyle);
</span></span><span style="display:flex;"><span>        StyleConstants.<span style="color:#a6e22e">setForeground</span>(systemStyle, <span style="color:#66d9ef">new</span> Color(128, 128, 128));
</span></span><span style="display:flex;"><span>        StyleConstants.<span style="color:#a6e22e">setItalic</span>(systemStyle, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// User messages style</span>
</span></span><span style="display:flex;"><span>        userStyle <span style="color:#f92672">=</span> chatDocument.<span style="color:#a6e22e">addStyle</span>(<span style="color:#e6db74">&#34;user&#34;</span>, defaultStyle);
</span></span><span style="display:flex;"><span>        StyleConstants.<span style="color:#a6e22e">setForeground</span>(userStyle, <span style="color:#66d9ef">new</span> Color(37, 99, 235));
</span></span><span style="display:flex;"><span>        StyleConstants.<span style="color:#a6e22e">setBold</span>(userStyle, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Private messages style</span>
</span></span><span style="display:flex;"><span>        privateStyle <span style="color:#f92672">=</span> chatDocument.<span style="color:#a6e22e">addStyle</span>(<span style="color:#e6db74">&#34;private&#34;</span>, defaultStyle);
</span></span><span style="display:flex;"><span>        StyleConstants.<span style="color:#a6e22e">setForeground</span>(privateStyle, <span style="color:#66d9ef">new</span> Color(139, 69, 19));
</span></span><span style="display:flex;"><span>        StyleConstants.<span style="color:#a6e22e">setItalic</span>(privateStyle, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Timestamp style</span>
</span></span><span style="display:flex;"><span>        timestampStyle <span style="color:#f92672">=</span> chatDocument.<span style="color:#a6e22e">addStyle</span>(<span style="color:#e6db74">&#34;timestamp&#34;</span>, defaultStyle);
</span></span><span style="display:flex;"><span>        StyleConstants.<span style="color:#a6e22e">setForeground</span>(timestampStyle, <span style="color:#66d9ef">new</span> Color(156, 163, 175));
</span></span><span style="display:flex;"><span>        StyleConstants.<span style="color:#a6e22e">setFontSize</span>(timestampStyle, 10);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setupLayout</span>() {
</span></span><span style="display:flex;"><span>        setLayout(<span style="color:#66d9ef">new</span> BorderLayout());
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Top panel - Connection controls</span>
</span></span><span style="display:flex;"><span>        JPanel topPanel <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JPanel(<span style="color:#66d9ef">new</span> FlowLayout(FlowLayout.<span style="color:#a6e22e">LEFT</span>));
</span></span><span style="display:flex;"><span>        topPanel.<span style="color:#a6e22e">setBorder</span>(<span style="color:#66d9ef">new</span> EmptyBorder(5, 5, 5, 5));
</span></span><span style="display:flex;"><span>        topPanel.<span style="color:#a6e22e">add</span>(<span style="color:#66d9ef">new</span> JLabel(<span style="color:#e6db74">&#34;Username:&#34;</span>));
</span></span><span style="display:flex;"><span>        topPanel.<span style="color:#a6e22e">add</span>(usernameField);
</span></span><span style="display:flex;"><span>        topPanel.<span style="color:#a6e22e">add</span>(connectButton);
</span></span><span style="display:flex;"><span>        topPanel.<span style="color:#a6e22e">add</span>(disconnectButton);
</span></span><span style="display:flex;"><span>        add(topPanel, BorderLayout.<span style="color:#a6e22e">NORTH</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Center panel - Chat area</span>
</span></span><span style="display:flex;"><span>        JScrollPane chatScrollPane <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JScrollPane(chatArea);
</span></span><span style="display:flex;"><span>        chatScrollPane.<span style="color:#a6e22e">setVerticalScrollBarPolicy</span>(JScrollPane.<span style="color:#a6e22e">VERTICAL_SCROLLBAR_ALWAYS</span>);
</span></span><span style="display:flex;"><span>        chatScrollPane.<span style="color:#a6e22e">setPreferredSize</span>(<span style="color:#66d9ef">new</span> Dimension(500, 400));
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Right panel - Users list</span>
</span></span><span style="display:flex;"><span>        JScrollPane usersScrollPane <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JScrollPane(usersList);
</span></span><span style="display:flex;"><span>        usersScrollPane.<span style="color:#a6e22e">setPreferredSize</span>(<span style="color:#66d9ef">new</span> Dimension(150, 400));
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Split pane for chat and users</span>
</span></span><span style="display:flex;"><span>        JSplitPane splitPane <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JSplitPane(JSplitPane.<span style="color:#a6e22e">HORIZONTAL_SPLIT</span>, 
</span></span><span style="display:flex;"><span>                                            chatScrollPane, usersScrollPane);
</span></span><span style="display:flex;"><span>        splitPane.<span style="color:#a6e22e">setDividerLocation</span>(550);
</span></span><span style="display:flex;"><span>        add(splitPane, BorderLayout.<span style="color:#a6e22e">CENTER</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Bottom panel - Message input</span>
</span></span><span style="display:flex;"><span>        JPanel bottomPanel <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> JPanel(<span style="color:#66d9ef">new</span> BorderLayout());
</span></span><span style="display:flex;"><span>        bottomPanel.<span style="color:#a6e22e">setBorder</span>(<span style="color:#66d9ef">new</span> EmptyBorder(5, 5, 5, 5));
</span></span><span style="display:flex;"><span>        bottomPanel.<span style="color:#a6e22e">add</span>(messageField, BorderLayout.<span style="color:#a6e22e">CENTER</span>);
</span></span><span style="display:flex;"><span>        bottomPanel.<span style="color:#a6e22e">add</span>(sendButton, BorderLayout.<span style="color:#a6e22e">EAST</span>);
</span></span><span style="display:flex;"><span>        add(bottomPanel, BorderLayout.<span style="color:#a6e22e">SOUTH</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setupEventHandlers</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Connect button</span>
</span></span><span style="display:flex;"><span>        connectButton.<span style="color:#a6e22e">addActionListener</span>(e <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            String username <span style="color:#f92672">=</span> usernameField.<span style="color:#a6e22e">getText</span>().<span style="color:#a6e22e">trim</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (username.<span style="color:#a6e22e">isEmpty</span>()) {
</span></span><span style="display:flex;"><span>                JOptionPane.<span style="color:#a6e22e">showMessageDialog</span>(<span style="color:#66d9ef">this</span>, 
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;Please enter a username&#34;</span>, <span style="color:#e6db74">&#34;Error&#34;</span>, 
</span></span><span style="display:flex;"><span>                    JOptionPane.<span style="color:#a6e22e">ERROR_MESSAGE</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (client.<span style="color:#a6e22e">connect</span>(username)) {
</span></span><span style="display:flex;"><span>                connectButton.<span style="color:#a6e22e">setEnabled</span>(<span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>                disconnectButton.<span style="color:#a6e22e">setEnabled</span>(<span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>                usernameField.<span style="color:#a6e22e">setEnabled</span>(<span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>                messageField.<span style="color:#a6e22e">requestFocus</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Disconnect button</span>
</span></span><span style="display:flex;"><span>        disconnectButton.<span style="color:#a6e22e">addActionListener</span>(e <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            client.<span style="color:#a6e22e">disconnect</span>();
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Send button</span>
</span></span><span style="display:flex;"><span>        sendButton.<span style="color:#a6e22e">addActionListener</span>(e <span style="color:#f92672">-&gt;</span> sendMessage());
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Enter key in message field</span>
</span></span><span style="display:flex;"><span>        messageField.<span style="color:#a6e22e">addActionListener</span>(e <span style="color:#f92672">-&gt;</span> sendMessage());
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Double-click on user for private message</span>
</span></span><span style="display:flex;"><span>        usersList.<span style="color:#a6e22e">addMouseListener</span>(<span style="color:#66d9ef">new</span> MouseAdapter() {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">@Override</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">mouseClicked</span>(MouseEvent e) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (e.<span style="color:#a6e22e">getClickCount</span>() <span style="color:#f92672">==</span> 2) {
</span></span><span style="display:flex;"><span>                    String selectedUser <span style="color:#f92672">=</span> usersList.<span style="color:#a6e22e">getSelectedValue</span>();
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> (selectedUser <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>selectedUser.<span style="color:#a6e22e">equals</span>(client.<span style="color:#a6e22e">getUsername</span>())) {
</span></span><span style="display:flex;"><span>                        String message <span style="color:#f92672">=</span> JOptionPane.<span style="color:#a6e22e">showInputDialog</span>(
</span></span><span style="display:flex;"><span>                            ChatGUI.<span style="color:#a6e22e">this</span>, 
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;Private message to &#34;</span> <span style="color:#f92672">+</span> selectedUser <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#e6db74">&#34;Private Message&#34;</span>,
</span></span><span style="display:flex;"><span>                            JOptionPane.<span style="color:#a6e22e">PLAIN_MESSAGE</span>);
</span></span><span style="display:flex;"><span>                        
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">if</span> (message <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>message.<span style="color:#a6e22e">trim</span>().<span style="color:#a6e22e">isEmpty</span>()) {
</span></span><span style="display:flex;"><span>                            client.<span style="color:#a6e22e">sendPrivateMessage</span>(selectedUser, message.<span style="color:#a6e22e">trim</span>());
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">sendMessage</span>() {
</span></span><span style="display:flex;"><span>        String message <span style="color:#f92672">=</span> messageField.<span style="color:#a6e22e">getText</span>().<span style="color:#a6e22e">trim</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>message.<span style="color:#a6e22e">isEmpty</span>() <span style="color:#f92672">&amp;&amp;</span> client.<span style="color:#a6e22e">isConnected</span>()) {
</span></span><span style="display:flex;"><span>            client.<span style="color:#a6e22e">sendMessage</span>(message);
</span></span><span style="display:flex;"><span>            messageField.<span style="color:#a6e22e">setText</span>(<span style="color:#e6db74">&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">displayMessage</span>(String sender, String message) {
</span></span><span style="display:flex;"><span>        SwingUtilities.<span style="color:#a6e22e">invokeLater</span>(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                String timestamp <span style="color:#f92672">=</span> timeFormat.<span style="color:#a6e22e">format</span>(<span style="color:#66d9ef">new</span> Date());
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Add timestamp</span>
</span></span><span style="display:flex;"><span>                chatDocument.<span style="color:#a6e22e">insertString</span>(chatDocument.<span style="color:#a6e22e">getLength</span>(), 
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;[&#34;</span> <span style="color:#f92672">+</span> timestamp <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] &#34;</span>, timestampStyle);
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Add sender name</span>
</span></span><span style="display:flex;"><span>                chatDocument.<span style="color:#a6e22e">insertString</span>(chatDocument.<span style="color:#a6e22e">getLength</span>(), 
</span></span><span style="display:flex;"><span>                    sender <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span>, userStyle);
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Add message</span>
</span></span><span style="display:flex;"><span>                chatDocument.<span style="color:#a6e22e">insertString</span>(chatDocument.<span style="color:#a6e22e">getLength</span>(), 
</span></span><span style="display:flex;"><span>                    message <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\n&#34;</span>, defaultStyle);
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                scrollToBottom();
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (BadLocationException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">displayPrivateMessage</span>(String otherUser, String message, <span style="color:#66d9ef">boolean</span> sent) {
</span></span><span style="display:flex;"><span>        SwingUtilities.<span style="color:#a6e22e">invokeLater</span>(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                String timestamp <span style="color:#f92672">=</span> timeFormat.<span style="color:#a6e22e">format</span>(<span style="color:#66d9ef">new</span> Date());
</span></span><span style="display:flex;"><span>                String prefix <span style="color:#f92672">=</span> sent <span style="color:#f92672">?</span> <span style="color:#e6db74">&#34;To &#34;</span> <span style="color:#f92672">+</span> otherUser : <span style="color:#e6db74">&#34;From &#34;</span> <span style="color:#f92672">+</span> otherUser;
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Add timestamp</span>
</span></span><span style="display:flex;"><span>                chatDocument.<span style="color:#a6e22e">insertString</span>(chatDocument.<span style="color:#a6e22e">getLength</span>(), 
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;[&#34;</span> <span style="color:#f92672">+</span> timestamp <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] &#34;</span>, timestampStyle);
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Add private message indicator</span>
</span></span><span style="display:flex;"><span>                chatDocument.<span style="color:#a6e22e">insertString</span>(chatDocument.<span style="color:#a6e22e">getLength</span>(), 
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;[PRIVATE] &#34;</span> <span style="color:#f92672">+</span> prefix <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;: &#34;</span>, privateStyle);
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Add message</span>
</span></span><span style="display:flex;"><span>                chatDocument.<span style="color:#a6e22e">insertString</span>(chatDocument.<span style="color:#a6e22e">getLength</span>(), 
</span></span><span style="display:flex;"><span>                    message <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\n&#34;</span>, defaultStyle);
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                scrollToBottom();
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (BadLocationException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">displayHistoryMessage</span>(String message) {
</span></span><span style="display:flex;"><span>        SwingUtilities.<span style="color:#a6e22e">invokeLater</span>(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                chatDocument.<span style="color:#a6e22e">insertString</span>(chatDocument.<span style="color:#a6e22e">getLength</span>(), 
</span></span><span style="display:flex;"><span>                    message <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\n&#34;</span>, systemStyle);
</span></span><span style="display:flex;"><span>                scrollToBottom();
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (BadLocationException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">showSystemMessage</span>(String message) {
</span></span><span style="display:flex;"><span>        SwingUtilities.<span style="color:#a6e22e">invokeLater</span>(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>                String timestamp <span style="color:#f92672">=</span> timeFormat.<span style="color:#a6e22e">format</span>(<span style="color:#66d9ef">new</span> Date());
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                chatDocument.<span style="color:#a6e22e">insertString</span>(chatDocument.<span style="color:#a6e22e">getLength</span>(), 
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#34;[&#34;</span> <span style="color:#f92672">+</span> timestamp <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;] &#34;</span> <span style="color:#f92672">+</span> message <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;\n&#34;</span>, systemStyle);
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                scrollToBottom();
</span></span><span style="display:flex;"><span>            } <span style="color:#66d9ef">catch</span> (BadLocationException e) {
</span></span><span style="display:flex;"><span>                e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">updateUsersList</span>(String<span style="color:#f92672">[]</span> users) {
</span></span><span style="display:flex;"><span>        SwingUtilities.<span style="color:#a6e22e">invokeLater</span>(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            usersModel.<span style="color:#a6e22e">clear</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (String user : users) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>user.<span style="color:#a6e22e">trim</span>().<span style="color:#a6e22e">isEmpty</span>()) {
</span></span><span style="display:flex;"><span>                    usersModel.<span style="color:#a6e22e">addElement</span>(user.<span style="color:#a6e22e">trim</span>());
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onDisconnected</span>() {
</span></span><span style="display:flex;"><span>        SwingUtilities.<span style="color:#a6e22e">invokeLater</span>(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            connectButton.<span style="color:#a6e22e">setEnabled</span>(<span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>            disconnectButton.<span style="color:#a6e22e">setEnabled</span>(<span style="color:#66d9ef">false</span>);
</span></span><span style="display:flex;"><span>            usernameField.<span style="color:#a6e22e">setEnabled</span>(<span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>            usersModel.<span style="color:#a6e22e">clear</span>();
</span></span><span style="display:flex;"><span>            showSystemMessage(<span style="color:#e6db74">&#34;🔴 Disconnected from server&#34;</span>);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">scrollToBottom</span>() {
</span></span><span style="display:flex;"><span>        SwingUtilities.<span style="color:#a6e22e">invokeLater</span>(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            chatArea.<span style="color:#a6e22e">setCaretPosition</span>(chatDocument.<span style="color:#a6e22e">getLength</span>());
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>(String<span style="color:#f92672">[]</span> args) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Set system look and feel</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            UIManager.<span style="color:#a6e22e">setLookAndFeel</span>(UIManager.<span style="color:#a6e22e">getSystemLookAndFeel</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (Exception e) {
</span></span><span style="display:flex;"><span>            e.<span style="color:#a6e22e">printStackTrace</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        SwingUtilities.<span style="color:#a6e22e">invokeLater</span>(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">new</span> ChatGUI().<span style="color:#a6e22e">setVisible</span>(<span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="tính-năng-nâng-cao">Tính năng nâng cao<a hidden class="anchor" aria-hidden="true" href="#tính-năng-nâng-cao">#</a></h2>
<h3 id="1-emoji-và-formatting">1. Emoji và Formatting<a hidden class="anchor" aria-hidden="true" href="#1-emoji-và-formatting">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Trong ChatGUI, thêm method để xử lý emoji</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> String <span style="color:#a6e22e">processEmojis</span>(String message) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> message
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#34;:)&#34;</span>, <span style="color:#e6db74">&#34;😊&#34;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#34;:(&#34;</span>, <span style="color:#e6db74">&#34;😢&#34;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#34;:D&#34;</span>, <span style="color:#e6db74">&#34;😃&#34;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#34;;)&#34;</span>, <span style="color:#e6db74">&#34;😉&#34;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#34;&lt;3&#34;</span>, <span style="color:#e6db74">&#34;❤️&#34;</span>)
</span></span><span style="display:flex;"><span>        .<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">&#34;:p&#34;</span>, <span style="color:#e6db74">&#34;😛&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="2-file-transfer">2. File Transfer<a hidden class="anchor" aria-hidden="true" href="#2-file-transfer">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Thêm vào ClientHandler</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">handleFileTransfer</span>(String message) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// FILE_TRANSFER:recipient:filename:size</span>
</span></span><span style="display:flex;"><span>    String<span style="color:#f92672">[]</span> parts <span style="color:#f92672">=</span> message.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#34;:&#34;</span>, 4);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (parts.<span style="color:#a6e22e">length</span> <span style="color:#f92672">&gt;=</span> 4) {
</span></span><span style="display:flex;"><span>        String recipient <span style="color:#f92672">=</span> parts<span style="color:#f92672">[</span>1<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>        String filename <span style="color:#f92672">=</span> parts<span style="color:#f92672">[</span>2<span style="color:#f92672">]</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">long</span> fileSize <span style="color:#f92672">=</span> Long.<span style="color:#a6e22e">parseLong</span>(parts<span style="color:#f92672">[</span>3<span style="color:#f92672">]</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Implement file transfer logic</span>
</span></span><span style="display:flex;"><span>        transferFile(recipient, filename, fileSize);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="3-roomchannel-system">3. Room/Channel System<a hidden class="anchor" aria-hidden="true" href="#3-roomchannel-system">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Thêm vào ChatServer</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> Map<span style="color:#f92672">&lt;</span>String, Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;&gt;</span> chatRooms <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConcurrentHashMap<span style="color:#f92672">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">joinRoom</span>(String username, String roomName) {
</span></span><span style="display:flex;"><span>    chatRooms.<span style="color:#a6e22e">computeIfAbsent</span>(roomName, k <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">new</span> HashSet<span style="color:#f92672">&lt;&gt;</span>())
</span></span><span style="display:flex;"><span>             .<span style="color:#a6e22e">add</span>(username);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    broadcastToRoom(roomName, <span style="color:#e6db74">&#34;USER_JOINED_ROOM:&#34;</span> <span style="color:#f92672">+</span> username <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>                   <span style="color:#e6db74">&#34; joined room &#34;</span> <span style="color:#f92672">+</span> roomName, <span style="color:#66d9ef">null</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">broadcastToRoom</span>(String roomName, String message, String sender) {
</span></span><span style="display:flex;"><span>    Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> roomUsers <span style="color:#f92672">=</span> chatRooms.<span style="color:#a6e22e">get</span>(roomName);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (roomUsers <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> (String username : roomUsers) {
</span></span><span style="display:flex;"><span>            ClientHandler handler <span style="color:#f92672">=</span> connectedClients.<span style="color:#a6e22e">get</span>(username);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (handler <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
</span></span><span style="display:flex;"><span>                handler.<span style="color:#a6e22e">sendMessage</span>(<span style="color:#e6db74">&#34;ROOM_MESSAGE:&#34;</span> <span style="color:#f92672">+</span> roomName <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> 
</span></span><span style="display:flex;"><span>                                   sender <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;:&#34;</span> <span style="color:#f92672">+</span> message);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="testing-và-deployment">Testing và Deployment<a hidden class="anchor" aria-hidden="true" href="#testing-và-deployment">#</a></h2>
<h3 id="1-unit-tests">1. Unit Tests<a hidden class="anchor" aria-hidden="true" href="#1-unit-tests">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#f92672">import</span> org.junit.jupiter.api.Test;
</span></span><span style="display:flex;"><span><span style="color:#f92672">import static</span> org.junit.jupiter.api.Assertions.*;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ChatServerTest</span> {
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testServerStartStop</span>() {
</span></span><span style="display:flex;"><span>        ChatServer server <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ChatServer();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Test server start</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> Thread(server::start).<span style="color:#a6e22e">start</span>();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Wait a bit for server to start</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>            Thread.<span style="color:#a6e22e">sleep</span>(1000);
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (InterruptedException e) {
</span></span><span style="display:flex;"><span>            Thread.<span style="color:#a6e22e">currentThread</span>().<span style="color:#a6e22e">interrupt</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Test connection</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">try</span> (Socket testSocket <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Socket(<span style="color:#e6db74">&#34;localhost&#34;</span>, 12345)) {
</span></span><span style="display:flex;"><span>            assertTrue(testSocket.<span style="color:#a6e22e">isConnected</span>());
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">catch</span> (IOException e) {
</span></span><span style="display:flex;"><span>            fail(<span style="color:#e6db74">&#34;Could not connect to server&#34;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Test server stop</span>
</span></span><span style="display:flex;"><span>        server.<span style="color:#a6e22e">stop</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@Test</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">testMessageBroadcast</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// Implement broadcast testing</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="2-dockerfile-cho-deployment">2. Dockerfile cho deployment<a hidden class="anchor" aria-hidden="true" href="#2-dockerfile-cho-deployment">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-dockerfile" data-lang="dockerfile"><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">openjdk:11-jre-slim</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">WORKDIR</span> <span style="color:#e6db74">/app</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">COPY</span> target/chat-server.jar .<span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span> <span style="color:#e6db74">12345</span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">CMD</span> [<span style="color:#e6db74">&#34;java&#34;</span>, <span style="color:#e6db74">&#34;-jar&#34;</span>, <span style="color:#e6db74">&#34;chat-server.jar&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span></span></span></code></pre></div><h2 id="performance-và-optimization">Performance và Optimization<a hidden class="anchor" aria-hidden="true" href="#performance-và-optimization">#</a></h2>
<h3 id="1-connection-pool-tuning">1. Connection Pool Tuning<a hidden class="anchor" aria-hidden="true" href="#1-connection-pool-tuning">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Trong ChatServer constructor</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ChatServer</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Optimize thread pool based on expected load</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> corePoolSize <span style="color:#f92672">=</span> Runtime.<span style="color:#a6e22e">getRuntime</span>().<span style="color:#a6e22e">availableProcessors</span>();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> maxPoolSize <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">max</span>(MAX_CLIENTS, corePoolSize <span style="color:#f92672">*</span> 2);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">clientPool</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ThreadPoolExecutor(
</span></span><span style="display:flex;"><span>        corePoolSize,
</span></span><span style="display:flex;"><span>        maxPoolSize,
</span></span><span style="display:flex;"><span>        60L, TimeUnit.<span style="color:#a6e22e">SECONDS</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> LinkedBlockingQueue<span style="color:#f92672">&lt;&gt;</span>(MAX_CLIENTS),
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> ThreadFactory() {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> counter <span style="color:#f92672">=</span> 0;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">public</span> Thread <span style="color:#a6e22e">newThread</span>(Runnable r) {
</span></span><span style="display:flex;"><span>                Thread t <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Thread(r, <span style="color:#e6db74">&#34;ChatClient-&#34;</span> <span style="color:#f92672">+</span> counter<span style="color:#f92672">++</span>);
</span></span><span style="display:flex;"><span>                t.<span style="color:#a6e22e">setDaemon</span>(<span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> t;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">new</span> ThreadPoolExecutor.<span style="color:#a6e22e">CallerRunsPolicy</span>()
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="2-memory-management">2. Memory Management<a hidden class="anchor" aria-hidden="true" href="#2-memory-management">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#75715e">// Định kỳ dọn dẹp chat history</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">cleanupOldMessages</span>() {
</span></span><span style="display:flex;"><span>    ScheduledExecutorService scheduler <span style="color:#f92672">=</span> Executors.<span style="color:#a6e22e">newScheduledThreadPool</span>(1);
</span></span><span style="display:flex;"><span>    scheduler.<span style="color:#a6e22e">scheduleAtFixedRate</span>(() <span style="color:#f92672">-&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">synchronized</span>(chatHistory) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (chatHistory.<span style="color:#a6e22e">size</span>() <span style="color:#f92672">&gt;</span> MAX_HISTORY_SIZE) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">int</span> removeCount <span style="color:#f92672">=</span> chatHistory.<span style="color:#a6e22e">size</span>() <span style="color:#f92672">-</span> MAX_HISTORY_SIZE;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0; i <span style="color:#f92672">&lt;</span> removeCount; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                    chatHistory.<span style="color:#a6e22e">remove</span>(0);
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }, 1, 1, TimeUnit.<span style="color:#a6e22e">HOURS</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="kết-luận">Kết luận<a hidden class="anchor" aria-hidden="true" href="#kết-luận">#</a></h2>
<p>Trong bài viết này, chúng ta đã xây dựng một ứng dụng chat đa người dùng hoàn chỉnh với Java Socket. Ứng dụng bao gồm:</p>
<h3 id="tính-năng-đã-triển-khai">Tính năng đã triển khai:<a hidden class="anchor" aria-hidden="true" href="#tính-năng-đã-triển-khai">#</a></h3>
<ul>
<li>✅ <strong>Multi-threaded server</strong> xử lý nhiều client đồng thời</li>
<li>✅ <strong>Real-time messaging</strong> với broadcast và private message</li>
<li>✅ <strong>User management</strong> với danh sách người dùng online</li>
<li>✅ <strong>Chat history</strong> lưu trữ tin nhắn gần đây</li>
<li>✅ <strong>GUI client</strong> với Swing interface</li>
<li>✅ <strong>Error handling</strong> và logging system</li>
<li>✅ <strong>Graceful shutdown</strong> và resource cleanup</li>
</ul>
<h3 id="điểm-mạnh-của-giải-pháp">Điểm mạnh của giải pháp:<a hidden class="anchor" aria-hidden="true" href="#điểm-mạnh-của-giải-pháp">#</a></h3>
<ul>
<li><strong>Scalable</strong>: Sử dụng thread pool để tối ưu hiệu suất</li>
<li><strong>Robust</strong>: Xử lý lỗi và disconnection tốt</li>
<li><strong>User-friendly</strong>: GUI trực quan và dễ sử dụng</li>
<li><strong>Extensible</strong>: Dễ dàng thêm tính năng mới</li>
</ul>
<h3 id="hướng-phát-triển-tiếp-theo">Hướng phát triển tiếp theo:<a hidden class="anchor" aria-hidden="true" href="#hướng-phát-triển-tiếp-theo">#</a></h3>
<ul>
<li>🔄 <strong>Database integration</strong> cho persistent storage</li>
<li>🔐 <strong>Authentication và authorization</strong></li>
<li>📁 <strong>File sharing</strong> capabilities</li>
<li>🏠 <strong>Room/Channel system</strong></li>
<li>🎨 <strong>Theme và customization</strong></li>
<li>📱 <strong>Mobile client</strong> development</li>
</ul>
<p>Đây là một project tuyệt vời để học về network programming, multi-threading, và GUI development trong Java!</p>
<hr>
<p><em>Bài viết này là một phần trong series &ldquo;Lập trình mạng với Java&rdquo;. Source code đầy đủ có thể tìm thấy trên <a href="https://github.com/khanhsss0209/java-chat-app">GitHub</a>.</em></p>


    </div>
  </div>
</article>

</div>

<style>
   
  .full-width-container {
    width: 100vw;
    margin-left: calc(-50vw + 50%);
    margin-right: calc(-50vw + 50%);
    padding: 0;
  }

   
  .content-wrapper {
    width: 100%;
    padding: 0 1rem;
    box-sizing: border-box;
    margin: 0 auto;
  }

  @media (min-width: 768px) {
    .content-wrapper {
      padding: 0 2rem;
    }
  }

  @media (min-width: 1200px) {
    .content-wrapper {
      padding: 0 3rem;
      max-width: 1400px;
    }
  }

  @media (min-width: 1600px) {
    .content-wrapper {
      padding: 0 4rem;
      max-width: 1600px;
    }
  }

   
  .post-header {
    background: white;
    padding: 3rem 0;
    border-bottom: 1px solid var(--soft-green);
    box-shadow: 0 4px 20px var(--shadow);
  }

  .post-title {
    font-size: 3rem;
    color: var(--primary-green);
    margin-bottom: 1rem;
    font-weight: 700;
    line-height: 1.2;
  }

  .post-description {
    font-size: 1.2rem;
    color: var(--text-dark);
    opacity: 0.8;
    margin-bottom: 2rem;
    line-height: 1.6;
  }

  .post-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 2rem;
    align-items: center;
    padding: 1.5rem 0;
    border-top: 1px solid var(--soft-green);
  }

  .post-date {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--secondary-green);
    font-size: 0.95rem;
  }

  .post-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .tag {
    background: var(--accent-green);
    color: var(--primary-green);
    padding: 0.4rem 0.8rem;
    border-radius: 15px;
    text-decoration: none;
    font-size: 0.85rem;
    font-weight: 500;
    transition: all 0.3s ease;
  }

  .tag:hover {
    background: var(--primary-green);
    color: var(--text-light);
    transform: translateY(-2px);
  }

  .reading-stats {
    display: flex;
    gap: 1.5rem;
    color: var(--secondary-green);
    font-size: 0.9rem;
  }

  .reading-time,
  .word-count {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

   
  .post-cover-section {
    width: 100%;
  }

  .post-cover-full {
    width: 100%;
    height: 400px;
    overflow: hidden;
  }

  .post-cover-full img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

   
  .post-content-section {
    background: white;
    padding: 4rem 0;
  }

  .post-content {
    font-size: 1.1rem;
    line-height: 1.8;
    color: var(--text-dark);
    max-width: 900px;
    margin: 0 auto;
  }

  .post-content h1,
  .post-content h2,
  .post-content h3,
  .post-content h4 {
    color: var(--primary-green);
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-weight: 600;
  }

  .post-content h1 {
    font-size: 2.5rem;
    border-bottom: 3px solid var(--accent-green);
    padding-bottom: 0.5rem;
  }

  .post-content h2 {
    font-size: 2rem;
    border-left: 4px solid var(--primary-green);
    padding-left: 1rem;
  }

  .post-content h3 {
    font-size: 1.5rem;
    color: var(--secondary-green);
  }

  .post-content p {
    margin-bottom: 1.5rem;
  }

  .post-content ul,
  .post-content ol {
    margin-bottom: 1.5rem;
    padding-left: 2rem;
  }

  .post-content li {
    margin-bottom: 0.5rem;
  }

  .post-content blockquote {
    background: var(--soft-green);
    border-left: 4px solid var(--primary-green);
    padding: 1.5rem;
    margin: 2rem 0;
    border-radius: 0 10px 10px 0;
    font-style: italic;
  }

  .post-content code {
    background: var(--soft-green);
    padding: 0.2rem 0.5rem;
    border-radius: 4px;
    font-family: 'Fira Code', 'Consolas', monospace;
    color: var(--primary-green);
  }

  .post-content pre {
    background: var(--dark-green);
    color: var(--text-light);
    padding: 1.5rem;
    border-radius: 10px;
    overflow-x: auto;
    margin: 2rem 0;
  }

  .post-content pre code {
    background: transparent;
    color: inherit;
    padding: 0;
  }

  .post-content img {
    max-width: 100%;
    height: auto;
    border-radius: 10px;
    margin: 2rem 0;
    box-shadow: 0 8px 25px var(--shadow);
  }

  .post-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 2rem 0;
    overflow-x: auto;
    display: block;
    white-space: nowrap;
  }

  .post-content th,
  .post-content td {
    border: 1px solid var(--soft-green);
    padding: 0.75rem;
    text-align: left;
  }

  .post-content th {
    background: var(--accent-green);
    color: var(--primary-green);
    font-weight: 600;
  }

   
  .post-navigation {
    background: var(--soft-green);
    padding: 3rem 0;
  }

  .post-nav {
    display: flex;
    justify-content: space-between;
    gap: 2rem;
  }

  .nav-link {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    background: white;
    border-radius: 15px;
    text-decoration: none;
    color: var(--text-dark);
    transition: all 0.3s ease;
    flex: 1;
    max-width: 400px;
    box-shadow: 0 4px 15px var(--shadow);
  }

  .nav-link:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px var(--shadow);
  }

  .nav-link.prev {
    margin-right: auto;
  }

  .nav-link.next {
    margin-left: auto;
    flex-direction: row-reverse;
  }

  .nav-content {
    flex: 1;
  }

  .nav-label {
    display: block;
    font-size: 0.85rem;
    color: var(--secondary-green);
    margin-bottom: 0.5rem;
  }

  .nav-title {
    display: block;
    font-weight: 600;
    color: var(--primary-green);
    font-size: 1.1rem;
  }

   
  .related-posts {
    background: white;
    padding: 4rem 0;
    border-top: 1px solid var(--soft-green);
  }

  .related-title {
    display: flex;
    align-items: center;
    gap: 1rem;
    color: var(--primary-green);
    font-size: 2rem;
    margin-bottom: 3rem;
    font-weight: 600;
    justify-content: center;
  }

  .related-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }

  .related-post {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    transition: all 0.3s ease;
    box-shadow: 0 8px 25px var(--shadow);
    border: 1px solid var(--soft-green);
  }

  .related-post:hover {
    transform: translateY(-8px);
    box-shadow: 0 15px 40px var(--shadow);
  }

  .related-cover {
    height: 150px;
    overflow: hidden;
  }

  .related-cover img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .related-post:hover .related-cover img {
    transform: scale(1.05);
  }

  .related-content {
    padding: 1.5rem;
  }

  .related-content h4 {
    margin-bottom: 0.5rem;
  }

  .related-content h4 a {
    color: var(--primary-green);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  .related-content h4 a:hover {
    color: var(--secondary-green);
  }

  .related-content p {
    color: var(--text-dark);
    opacity: 0.8;
    margin-bottom: 1rem;
    font-size: 0.9rem;
  }

  .related-content time {
    color: var(--secondary-green);
    font-size: 0.85rem;
  }

   
  @media (max-width: 768px) {
    .full-width-container {
      width: 100%;
      margin-left: 0;
      margin-right: 0;
    }

    .content-wrapper {
      padding: 0 1rem;
    }

    .post-title {
      font-size: 2.2rem;
    }

    .post-meta {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }

    .post-cover-full {
      height: 250px;
    }

    .post-nav {
      flex-direction: column;
    }

    .nav-link {
      max-width: none;
    }

    .nav-link.next {
      flex-direction: row;
    }

    .related-grid {
      grid-template-columns: 1fr;
    }

    .post-content {
      font-size: 1rem;
    }

    .post-content h1 {
      font-size: 2rem;
    }

    .post-content h2 {
      font-size: 1.6rem;
    }
  }

  @media (max-width: 480px) {
    .post-title {
      font-size: 1.8rem;
    }

    .related-title {
      font-size: 1.6rem;
      flex-direction: column;
      gap: 0.5rem;
    }

    .post-content table {
      font-size: 0.9rem;
    }
  }
</style>
    </main>
    
<footer class="footer">
    <div class="container">
        <div class="footer-content">
            <div class="footer-section">
                <h3>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 8px;">
                        <path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z"/>
                    </svg>
                    Blog Lập Trình Mạng
                </h3>
                <p style="margin-bottom: 1rem; opacity: 0.9;">Blog chia sẻ kiến thức lập trình mạng, Java và JavaScript với những bài viết chất lượng và cập nhật.</p>
                <div class="social-links">
                    <a href="mailto:noobkhanh@gmail.com" title="Email" style="margin-right: 1rem;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                    </a>
                    <a href="https://github.com/khanhsss0209" title="GitHub" target="_blank" rel="noopener noreferrer">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
                        </svg>
                    </a>
                </div>
            </div>

            <div class="footer-section">
                <h3>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 8px;">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                    </svg>
                    Chủ đề chính
                </h3>
                <ul style="list-style: none;">
                    <li style="margin-bottom: 0.5rem;">
                        <a href="/tags/java/">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 6px;">
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            Lập trình Java
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="/tags/javascript/">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 6px;">
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            JavaScript & Web
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="/tags/networking/">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 6px;">
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            Lập trình mạng
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="/tags/http/">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 6px;">
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            HTTP & API
                        </a>
                    </li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 8px;">
                        <path d="M9 11H1l6-6 6 6z"></path>
                        <path d="M9 17l3 3 3-3"></path>
                        <path d="M22 18.5V2l-5 5-5-5v16.5"></path>
                    </svg>
                    Điều hướng
                </h3>
                <ul style="list-style: none;">
                    <li style="margin-bottom: 0.5rem;">
                        <a href="/">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 6px;">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            </svg>
                            Trang chủ
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="/posts/">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 6px;">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14,2 14,8 20,8"></polyline>
                            </svg>
                            Bài viết
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="/archives/">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 6px;">
                                <polyline points="21,8 21,21 3,21 3,8"></polyline>
                                <rect x="1" y="3" width="22" height="5"></rect>
                                <line x1="10" y1="12" x2="14" y2="12"></line>
                            </svg>
                            Kho bài viết
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="/about/">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 6px;">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 16v-4"></path>
                                <path d="M12 8h0"></path>
                            </svg>
                            Giới thiệu
                        </a>
                    </li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 8px;">
                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                        <line x1="8" y1="21" x2="16" y2="21"></line>
                        <line x1="12" y1="17" x2="12" y2="21"></line>
                    </svg>
                    Công nghệ
                </h3>
                <p style="margin-bottom: 1rem; opacity: 0.9;">Blog được xây dựng với:</p>
                <div class="tech-stack">
                    <span class="tech-item">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 6px;">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                        Hugo
                    </span>
                    <span class="tech-item">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 6px;">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                        </svg>
                        PaperMod
                    </span>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
                <span>&copy; 2025 <a href="http://localhost:1313/khanhsss0209/">Blog Lập Trình Mạng</a></span> • 

            <span>
                Được tạo bởi
                <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
                <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
                với ❤️ xanh
            </span>
        </div>
    </div>
</footer>
<a href="#top" aria-label="go to top" title="Lên đầu trang (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<style>
    .social-links {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
    }

    .social-links a {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: var(--secondary-green);
        border-radius: 50%;
        color: var(--text-light);
        transition: all 0.3s ease;
    }

    .social-links a:hover {
        background: var(--accent-green);
        color: var(--primary-green);
        transform: translateY(-3px);
    }

    .tech-stack {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .tech-item {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        background: var(--secondary-green);
        border-radius: 15px;
        font-size: 0.9rem;
        width: fit-content;
    }

    .top-link {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        width: 50px;
        height: 50px;
        background: var(--gradient-primary);
        color: var(--text-light);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        z-index: 1000;
        box-shadow: 0 4px 15px var(--shadow);
    }

    .top-link.visible {
        opacity: 1;
        visibility: visible;
    }

    .top-link:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(45, 90, 39, 0.3);
    }

    .footer-section ul li {
        transition: all 0.3s ease;
    }

    .footer-section ul li:hover {
        transform: translateX(5px);
    }

    .footer-section h3 {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
        font-size: 1.1rem;
        font-weight: 600;
    }

    @media (max-width: 768px) {
        .footer-content {
            grid-template-columns: 1fr;
            text-align: center;
        }

        .social-links {
            justify-content: center;
        }

        .tech-stack {
            align-items: center;
        }

        .top-link {
            bottom: 1rem;
            right: 1rem;
            width: 45px;
            height: 45px;
        }
    }
</style>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.classList.add("visible");
        } else {
            mybutton.classList.remove("visible");
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })
</script><script>
        
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -100px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                }
            });
        }, observerOptions);

        document.querySelectorAll('.content-card').forEach(card => {
            observer.observe(card);
        });

        
        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark');
                localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
            });

            
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark');
            }
        }
    </script>
</body>

</html>